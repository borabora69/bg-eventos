<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BG Eventos & Hospedagem ‚Äî Barra Grande PI</title>
  <meta name="description" content="Eventos e hospedagem em Barra Grande PI." />
  <style>
    :root {
      --bg: #071025; --surface: #0b1220; --text: #eaf6fb; --muted: #9aa4b2;
      --accent: #06b6d4; --accent-2: #7c3aed; --radius: 12px;
      --shadow: 0 10px 30px rgba(2,6,23,0.6);
    }
    
    :root[data-theme="light"] {
      --bg: #f6f8fb; --surface: #fff; --text: #071025; --muted: #475569;
      --shadow: 0 8px 24px rgba(2,6,23,0.06);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg); color: var(--text); padding: 20px;
      transition: background 0.3s, color 0.3s;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* HEADER */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent);
    }
    
    .controls {
      display: flex;
      gap: 10px;
    }
    
    .btn {
      padding: 8px 16px;
      background: var(--surface);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn:hover {
      background: var(--accent);
      color: #000;
    }
    
    /* FILTROS DE DATA */
    .date-filter {
      background: var(--surface);
      padding: 20px;
      border-radius: var(--radius);
      margin-bottom: 30px;
      box-shadow: var(--shadow);
    }
    
    .filter-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: flex-end;
    }
    
    .input-group {
      flex: 1;
      min-width: 200px;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 5px;
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    .input-group input {
      width: 100%;
      padding: 10px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: var(--text);
      font-size: 1rem;
    }
    
    .btn-search {
      background: var(--accent);
      color: #000;
      font-weight: bold;
      padding: 10px 30px;
    }
    
    /* GRID DE EVENTOS */
    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .event-card {
      background: var(--surface);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: transform 0.3s;
    }
    
    .event-card:hover {
      transform: translateY(-5px);
    }
    
    .event-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      display: block;
    }
    
    .event-content {
      padding: 20px;
    }
    
    .event-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: var(--accent);
    }
    
    .event-date {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 15px;
    }
    
    .event-description {
      margin-bottom: 15px;
      line-height: 1.5;
    }
    
    .event-price {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: white;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      margin: 15px 0;
    }
    
    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 20px;
    }
    
    .action-btn {
      padding: 10px;
      background: var(--accent);
      color: #000;
      text-decoration: none;
      text-align: center;
      border-radius: 8px;
      font-weight: bold;
      transition: opacity 0.2s;
    }
    
    .action-btn:hover {
      opacity: 0.9;
    }
    
    .action-btn.secondary {
      background: var(--accent-2);
      color: white;
    }
    
    /* LOADER */
    .loader {
      text-align: center;
      padding: 40px;
      grid-column: 1 / -1;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--muted);
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* FOOTER */
    footer {
      text-align: center;
      margin-top: 50px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    /* RESPONSIVO */
    @media (max-width: 768px) {
      .events-grid {
        grid-template-columns: 1fr;
      }
      
      .action-buttons {
        grid-template-columns: 1fr;
      }
      
      .filter-row {
        flex-direction: column;
      }
      
      .input-group {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">üèùÔ∏è BG Eventos & Hospedagem</div>
      <div class="controls">
        <button class="btn" id="theme-toggle">üåô Tema</button>
      </div>
    </header>

    <main>
      <!-- FILTRO DE DATAS -->
      <section class="date-filter">
        <div class="filter-row">
          <div class="input-group">
            <label for="checkin">Data de Chegada</label>
            <input type="date" id="checkin">
          </div>
          
          <div class="input-group">
            <label for="checkout">Data de Sa√≠da</label>
            <input type="date" id="checkout">
          </div>
          
          <button class="btn btn-search" id="search-btn">üîç Buscar</button>
        </div>
        
        <div style="margin-top: 15px; color: var(--muted); font-size: 0.9rem;">
          Encontre eventos que acontecem durante sua estadia
        </div>
      </section>

      <!-- CONTADOR -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Eventos Dispon√≠veis</h2>
        <div class="btn" id="event-counter">0 eventos</div>
      </div>

      <!-- GRID DE EVENTOS -->
      <div class="events-grid" id="events-grid">
        <div class="loader">
          <div class="spinner"></div>
          <p>Carregando eventos...</p>
        </div>
      </div>
    </main>

    <footer>
      <p>¬© 2024 BG Eventos & Hospedagem | Barra Grande - PI</p>
      <p style="margin-top: 10px;">Atualizado automaticamente</p>
    </footer>
  </div>

  <script>
    // CONFIGURA√á√ïES
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTYagiDybnUZ6o0nrMPg9OAa5af9fX5pSgc0FW1R3w_A53ueEA-xMyp3SAjpx_rIxJgBGGfic-Q3LDv/pub?output=csv';
    const DEFAULT_IMAGE = 'img/eventos/padrao-bg.png';
    
    // ESTADO
    let events = [];
    let currentTheme = localStorage.getItem('theme') || 'dark';
    
    // INICIALIZA√á√ÉO
    document.addEventListener('DOMContentLoaded', () => {
      initTheme();
      setupDates();
      loadEvents();
    });
    
    // TEMA
    function initTheme() {
      if (currentTheme === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
      }
      
      document.getElementById('theme-toggle').addEventListener('click', () => {
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        currentTheme = isDark ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', currentTheme);
        localStorage.setItem('theme', currentTheme);
        
        // Atualizar texto do bot√£o
        const btn = document.getElementById('theme-toggle');
        btn.textContent = currentTheme === 'dark' ? 'üåô Tema' : '‚òÄÔ∏è Tema';
      });
    }
    
    // DATAS
    function setupDates() {
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      
      const formatDate = (date) => date.toISOString().split('T')[0];
      
      document.getElementById('checkin').value = formatDate(today);
      document.getElementById('checkout').value = formatDate(tomorrow);
      
      // Buscar eventos ao clicar
      document.getElementById('search-btn').addEventListener('click', filterEventsByDates);
    }
    
    // CARREGAR EVENTOS
    async function loadEvents() {
      try {
        const response = await fetch(CSV_URL + '&t=' + Date.now());
        const csvText = await response.text();
        
        events = parseCSV(csvText);
        filterEventsByDates();
        
      } catch (error) {
        console.error('Erro ao carregar eventos:', error);
        showError('Erro ao carregar eventos. Recarregue a p√°gina.');
      }
    }
    
    // PARSER CSV SIMPLES E FUNCIONAL
    function parseCSV(csvText) {
      const lines = csvText.split('\n').filter(line => line.trim());
      if (lines.length < 2) return [];
      
      // Encontrar cabe√ßalhos - considerar que a primeira linha tem os t√≠tulos
      const headers = lines[0].split(',').map(h => h.trim());
      
      const results = [];
      
      for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        const values = [];
        let current = '';
        let inQuotes = false;
        
        for (let j = 0; j < line.length; j++) {
          const char = line[j];
          
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            values.push(current);
            current = '';
          } else {
            current += char;
          }
        }
        values.push(current);
        
        const event = {};
        headers.forEach((header, index) => {
          event[header] = (values[index] || '').trim();
        });
        
        // Validar evento b√°sico
        if (event.ID && event.Nome && event.Fim) {
          // Converter datas
          event.inicioDate = parseDate(event.Inicio);
          event.fimDate = parseDate(event.Fim);
          
          // Converter pre√ßo para n√∫mero
          event.precoNum = parseFloat(event.Preco_Hotel) || 0;
          
          results.push(event);
        }
      }
      
      return results;
    }
    
    function parseDate(dateStr) {
      if (!dateStr) return null;
      
      // Tentar formato YYYY-MM-DD
      const parts = dateStr.split('-');
      if (parts.length === 3) {
        const year = parseInt(parts[0]);
        const month = parseInt(parts[1]) - 1;
        const day = parseInt(parts[2]);
        
        if (!isNaN(year) && !isNaN(month) && !isNaN(day)) {
          return new Date(year, month, day);
        }
      }
      
      // Tentar formato DD/MM/YYYY
      const parts2 = dateStr.split('/');
      if (parts2.length === 3) {
        const day = parseInt(parts2[0]);
        const month = parseInt(parts2[1]) - 1;
        const year = parseInt(parts2[2]);
        
        if (!isNaN(year) && !isNaN(month) && !isNaN(day)) {
          return new Date(year, month, day);
        }
      }
      
      return null;
    }
    
    // FILTRAR POR DATAS
    function filterEventsByDates() {
      const checkin = document.getElementById('checkin').value;
      const checkout = document.getElementById('checkout').value;
      
      if (!checkin || !checkout) {
        renderEvents(events);
        return;
      }
      
      const startDate = new Date(checkin);
      const endDate = new Date(checkout);
      
      const filtered = events.filter(event => {
        // Evento ocorre durante o per√≠odo selecionado?
        const eventoInicio = event.inicioDate;
        const eventoFim = event.fimDate;
        
        if (!eventoInicio || !eventoFim) return false;
        
        // O evento acontece durante o per√≠odo selecionado?
        return (eventoInicio <= endDate && eventoFim >= startDate);
      });
      
      renderEvents(filtered);
    }
    
    // RENDERIZAR EVENTOS
    function renderEvents(eventList) {
      const grid = document.getElementById('events-grid');
      const counter = document.getElementById('event-counter');
      
      if (!eventList || eventList.length === 0) {
        grid.innerHTML = `
          <div class="loader">
            <p>Nenhum evento encontrado para estas datas</p>
          </div>
        `;
        counter.textContent = '0 eventos';
        return;
      }
      
      counter.textContent = `${eventList.length} ${eventList.length === 1 ? 'evento' : 'eventos'}`;
      
      grid.innerHTML = eventList.map(event => `
        <div class="event-card">
          <img class="event-image" 
               src="img/eventos/${event.ID.toLowerCase().trim()}.png" 
               alt="${event.Nome}"
               loading="lazy"
               onerror="this.onerror=null; this.src='img/eventos/${event.ID.toLowerCase().trim()}.jpg'; this.onerror=function(){this.src='${DEFAULT_IMAGE}'}">
          
          <div class="event-content">
            <h3 class="event-title">${event.Nome}</h3>
            
            <div class="event-date">
              üìÖ ${formatDate(event.Inicio)} - ${formatDate(event.Fim)}
            </div>
            
            <p class="event-description">${event.Descricao || 'Evento em Barra Grande'}</p>
            
            ${event.Preco_Hotel ? `
              <div class="event-price">
                üí∞ Di√°ria a partir de R$ ${parseFloat(event.Preco_Hotel).toFixed(2)}
              </div>
            ` : ''}
            
            <div class="action-buttons">
              ${event.Link_Hotel ? `
                <a href="${addTracking(event.Link_Hotel, 'hotel')}" 
                   target="_blank" 
                   class="action-btn"
                   onclick="trackClick('${event.ID}', 'hotel')">
                  üè® Hospedagem
                </a>
              ` : '<div></div>'}
              
              ${event.Link_Ingresso ? `
                <a href="${addTracking(event.Link_Ingresso, 'ingresso')}" 
                   target="_blank" 
                   class="action-btn secondary"
                   onclick="trackClick('${event.ID}', 'ingresso')">
                  üé´ Ingressos
                </a>
              ` : ''}
            </div>
          </div>
        </div>
      `).join('');
    }
    
    // FORMATAR DATA
    function formatDate(dateStr) {
      if (!dateStr) return 'Data n√£o informada';
      
      const date = parseDate(dateStr);
      if (!date) return dateStr;
      
      return date.toLocaleDateString('pt-BR');
    }
    
    // ADICIONAR TRACKING
    function addTracking(url, source) {
      if (!url || !url.startsWith('http')) return '#';
      
      try {
        const urlObj = new URL(url);
        urlObj.searchParams.set('utm_source', 'bg-eventos');
        urlObj.searchParams.set('utm_medium', source);
        return urlObj.toString();
      } catch {
        return url;
      }
    }
    
    // TRACKING DE CLICKS
    function trackClick(eventId, type) {
      console.log(`Click: ${eventId} - ${type}`);
      // Aqui voc√™ pode adicionar Google Analytics ou outro tracking
    }
    
    // MOSTRAR ERRO
    function showError(message) {
      const grid = document.getElementById('events-grid');
      grid.innerHTML = `
        <div class="loader">
          <p style="color: #ff6b6b;">${message}</p>
          <button onclick="loadEvents()" style="margin-top: 10px; padding: 10px 20px; background: var(--accent); border: none; border-radius: 8px; cursor: pointer;">
            Tentar Novamente
          </button>
        </div>
      `;
    }
    
    // ATUALIZAR AUTOMATICAMENTE
    setInterval(loadEvents, 5 * 60 * 1000); // 5 minutos
  </script>
</body>
</html>
